<div class="mx-auto max-w-5xl p-4">
  <div class="card mb-4">
    <div class="card-body">
      <div class="flex items-center justify-between gap-4">
        <div>
          <h1 class="text-xl font-semibold mb-1">Mi suscripción</h1>
          <p class="text-slate-600">Elige un plan mensual según tus necesidades. Puedes cambiarlo cuando quieras.</p>
        </div>
        <a routerLink="/perfil" class="btn btn-secondary"><i class="bi bi-person me-1"></i>Volver a perfil</a>
      </div>
      <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
        <div class="p-3 rounded-md bg-slate-50 border border-slate-200">
          <div class="text-[11px] uppercase text-slate-600">Plan actual</div>
          <div class="text-lg font-semibold">{{ current().name }}</div>
          <div class="text-slate-600 text-sm">$ {{ current().priceCop }} COP/mes</div>
        </div>
      </div>
    </div>
  </div>

  @if (loading()) {
    <div class="text-center py-8">
      <i class="bi bi-arrow-repeat animate-spin text-2xl mb-2"></i>
      <p class="text-slate-600">Cargando planes...</p>
    </div>
  } @else if (error() && plans().length === 0) {
    <div class="alert alert-danger">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error() }}
      <button type="button" class="btn btn-sm btn-outline-danger ms-2" (click)="loadPlans()">
        Reintentar
      </button>
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      @for (p of plans(); track p.publicId) {
        <label class="plan-card" [class.selected]="isSelected(p)" (click)="select(p)">
          <div class="flex items-center justify-between">
            <h3 class="title">{{ p.name }}</h3>
            @if (p.popular) {<span class="badge">Más popular</span>}
          </div>
          <div class="price">$ {{ p.priceCop }} <span class="per">COP/mes</span></div>
          <p class="desc">{{ p.description }}</p>
          <ul class="features">
            <li><i class="bi bi-people"></i> Hasta {{ p.limits.maxUsers }} usuarios</li>
            <li><i class="bi bi-images"></i> {{ p.limits.maxImagesPerJob }} imágenes por trabajo</li>
            <li><i class="bi bi-person-vcard"></i> {{ p.limits.maxClientes | number }} clientes</li>
            <li><i class="bi bi-heart-pulse"></i> {{ p.limits.maxPacientes | number }} pacientes</li>
            <li><i class="bi bi-briefcase"></i> {{ p.limits.maxTrabajos | number }} trabajos</li>
          </ul>
          <div class="mt-3">
            <button type="button" class="btn w-full" [class.btn-primary]="isSelected(p)" [class.btn-outline]="!isSelected(p)">
              {{ isSelected(p) ? 'Seleccionado' : 'Elegir plan' }}
            </button>
          </div>
        </label>
      }
    </div>

    <div class="mt-4 flex items-center gap-3">
      <button type="button" class="btn btn-primary" [disabled]="saving()" (click)="actualizar()">
        <i class="bi bi-arrow-repeat me-1" [class.animate-spin]="saving()"></i>
        Actualizar suscripción
      </button>
      @if (success()) {<span class="text-green-700">{{ success() }}</span>}
      @if (error()) {<span class="text-red-700">{{ error() }}</span>}
    </div>
  }
</div>
