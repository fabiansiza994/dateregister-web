<!-- Header -->
<div class="flex flex-wrap items-center justify-between mb-6 gap-4">
  <div class="space-y-1">
    <h3 class="text-xl font-semibold m-0">Detalle de cliente</h3>
    <p class="text-xs text-slate-500 m-0">Información del cliente y sus pacientes asociados</p>
  </div>
  <div>
    <a class="btn btn-outline-secondary" (click)="volver()">&larr; Volver a clientes</a>
  </div>
</div>

@if (error()) {
<div class="rounded-lg border border-red-300 bg-red-50 text-red-700 px-4 py-3 text-sm flex gap-3 items-start mb-5" role="alert">
  <i class="bi bi-exclamation-triangle mt-1"></i>
  <div class="font-medium flex-1">{{ error() }}</div>
  <button type="button" class="btn btn-close" aria-label="Cerrar" (click)="error.set(null)"></button>
</div>
}

@if (loading()) {
<div class="text-center py-6 text-slate-500">
  <div class="inline-flex items-center gap-2"><span class="spinner-border spinner-border-sm"></span> Cargando…</div>
</div>
} @else {

@if (cliente()) {
<!-- Card datos del cliente -->
<div class="bg-white rounded-2xl shadow-card border border-slate-200/60 mb-6">
  <div class="p-5">
    <div class="flex items-start justify-between">
      <div>
        <h5 class="m-0 font-semibold flex items-center gap-2">
          <i class="bi bi-person-vcard-fill text-slate-400"></i>
          <span>{{ cliente()?.nombre }} <span class="font-normal">{{ cliente()?.apellido }}</span></span>
        </h5>
        <div class="text-xs text-slate-500 mt-1">ID: {{ cliente()?.id }} · Identificación: <span class="font-mono">{{ cliente()?.identificacion }}</span></div>
      </div>
      <span class="px-2 py-0.5 rounded-full text-[11px] font-medium self-start" [class.bg-green-100]="cliente()?.estado==='ACTIVO'" [class.text-green-700]="cliente()?.estado==='ACTIVO'" [class.bg-slate-200]="cliente()?.estado!=='ACTIVO'" [class.text-slate-600]="cliente()?.estado!=='ACTIVO'">{{ cliente()?.estado }}</span>
    </div>

    <hr class="my-4 border-slate-200">

    <div class="grid gap-4 md:grid-cols-3 text-sm">
      <div>
        <div class="text-slate-500">Email</div>
        <div>
          <a *ngIf="cliente()?.email" [href]="'mailto:' + cliente()?.email" class="text-primary hover:underline">{{ cliente()?.email }}</a>
          <span *ngIf="!cliente()?.email">—</span>
        </div>
      </div>
      <div>
        <div class="text-slate-500">Teléfono</div>
        <div>{{ cliente()?.telefono || '—' }}</div>
      </div>
      <div>
        <div class="text-slate-500">Dirección</div>
        <div>{{ cliente()?.direccion || '—' }}</div>
      </div>
    </div>
  </div>
</div>

@if(sector() === 'SALUD') {
<!-- Pacientes header -->
<div class="flex items-center justify-between mb-3">
  <h5 class="m-0 font-semibold">Pacientes</h5>
  <small class="text-slate-500">Total: {{ totalPacientes() }}</small>
  </div>

<!-- Tabla desktop -->
<div class="hidden md:block rounded-2xl shadow-card overflow-hidden border border-slate-200/70 bg-white">
  <table class="w-full text-sm align-middle">
    <thead class="bg-slate-100 text-slate-700">
      <tr>
        <th class="px-3 py-2 w-[70px]">#</th>
        <th class="px-3 py-2">Documento</th>
        <th class="px-3 py-2">Nombre</th>
        <th class="px-3 py-2">Apellido</th>
        <th class="px-3 py-2">Teléfono</th>
        <th class="px-3 py-2">Email</th>
        <th class="px-3 py-2">Dirección</th>
        <th class="px-3 py-2">Estado</th>
      </tr>
    </thead>
    <tbody>
      @if (visibles().length === 0) {
      <tr>
        <td colspan="8" class="text-center px-3 py-6 text-slate-500">Este cliente no tiene pacientes.</td>
      </tr>
      } @else {
      @for (p of visibles(); track p.id) {
      <tr class="odd:bg-white even:bg-slate-50">
        <td class="px-3 py-2 text-xs text-slate-500">{{ (page()-1)*pageSize() + $index + 1 }}</td>
        <td class="px-3 py-2 font-mono">{{ p.documento }}</td>
        <td class="px-3 py-2 font-semibold">{{ p.nombre }}</td>
        <td class="px-3 py-2">{{ p.apellido || '—' }}</td>
        <td class="px-3 py-2">{{ p.telefono || '—' }}</td>
        <td class="px-3 py-2">
          <a *ngIf="p.email" [href]="'mailto:' + p.email" class="text-primary hover:underline">{{ p.email }}</a>
          <span *ngIf="!p.email">—</span>
        </td>
        <td class="px-3 py-2">{{ p.direccion || '—' }}</td>
        <td class="px-3 py-2">
          <span class="px-2 py-0.5 rounded-full text-[11px] font-medium" [class.bg-green-100]="p.estado==='ACTIVO'" [class.text-green-700]="p.estado==='ACTIVO'" [class.bg-slate-200]="p.estado!=='ACTIVO'" [class.text-slate-600]="p.estado!=='ACTIVO'">{{ p.estado }}</span>
        </td>
      </tr>
      }
      }
    </tbody>
  </table>
</div>
}

<!-- Cards mobile -->
<div class="md:hidden">
  @if (visibles().length === 0) {
  <div class="rounded-lg border border-slate-300 bg-slate-50 text-center text-slate-500 px-4 py-3 text-sm">Este cliente no tiene pacientes.</div>
  } @else {
  <div class="grid gap-4">
    @for (p of visibles(); track p.id) {
    <div class="bg-white rounded-2xl shadow-card border border-slate-200/60">
      <div class="p-4">
        <div class="mb-2 flex items-start justify-between">
          <div>
            <div class="text-[11px] text-slate-500">#{{ (page()-1)*pageSize() + $index + 1 }}</div>
            <h6 class="m-0 font-semibold flex items-center text-sm"><i class="bi bi-person text-slate-400 mr-1"></i>{{ p.nombre }} <span class="font-normal ml-1">{{ p.apellido || '' }}</span></h6>
            <div class="text-xs text-slate-500">Documento: <span class="font-mono">{{ p.documento }}</span></div>
          </div>
          <span class="px-2 py-0.5 rounded-full text-[11px] font-medium" [class.bg-green-100]="p.estado==='ACTIVO'" [class.text-green-700]="p.estado==='ACTIVO'" [class.bg-slate-200]="p.estado!=='ACTIVO'" [class.text-slate-600]="p.estado!=='ACTIVO'">{{ p.estado }}</span>
        </div>
        <ul class="space-y-1 mb-0 text-[11px]">
          <li *ngIf="p.telefono" class="flex items-center"><span class="text-slate-500">Teléfono:</span><span class="ml-1">{{ p.telefono }}</span></li>
          <li *ngIf="p.email" class="flex items-center flex-wrap"><span class="text-slate-500">Email:</span><a [href]="'mailto:' + p.email" class="ml-1 text-primary hover:underline break-all">{{ p.email }}</a></li>
          <li *ngIf="p.direccion" class="flex items-center"><span class="text-slate-500">Dirección:</span><span class="ml-1">{{ p.direccion }}</span></li>
        </ul>
      </div>
    </div>
    }
  </div>
  }
</div>

@if (sector() === 'SALUD') {
<!-- Paginación pacientes -->
<div class="flex items-center justify-between mt-4">
  <div class="text-xs text-slate-600">Mostrando <strong>{{ visibles().length }}</strong> de <strong>{{ totalPacientes() }}</strong></div>
  <div class="inline-flex rounded-lg shadow-sm overflow-hidden border border-slate-300 bg-white">
    <button class="px-3 py-1.5 text-xs font-medium hover:bg-slate-50 disabled:opacity-50" (click)="prevPage()" [disabled]="page()<=1">Anterior</button>
    <span class="px-3 py-1.5 text-xs border-l border-r border-slate-300 bg-slate-50">Página {{ page() }} / {{ totalPages() }}</span>
    <button class="px-3 py-1.5 text-xs font-medium hover:bg-slate-50 disabled:opacity-50" (click)="nextPage()" [disabled]="page()>=totalPages()">Siguiente</button>
  </div>
</div>
}
} @else {
<div class="rounded-lg border border-slate-300 bg-slate-50 text-center text-slate-500 px-4 py-3">No se encontró el cliente.</div>
}

}
