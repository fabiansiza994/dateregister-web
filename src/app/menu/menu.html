<nav class="sticky-top bg-primary text-white shadow-sm">
  <div class="mx-auto max-w-7xl px-4">
    <div class="flex items-center gap-4 h-14">
      <!-- Marca -->
      <a routerLink="/modules" (click)="closeAll()" class="flex items-center gap-2 font-semibold min-w-0">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-white/20 text-xs font-bold uppercase shrink-0">{{ initials(empresa()) }}</span>
        <!-- Empresa: dos líneas controladas -->
        <span class="flex flex-col max-w-[140px] sm:max-w-[220px] brand-lines" [attr.title]="empresa()">
          <span class="leading-tight text-[13px] sm:text-sm font-semibold text-white truncate">{{ brandLines().l1 }}</span>
          @if (brandLines().l2) {<span class="leading-tight text-[10px] sm:text-[11px] text-white/80 font-medium truncate">{{ brandLines().l2 }}</span>}
        </span>
        @if (sector()) {<span class="hidden sm:inline-flex items-center rounded-full bg-white/30 text-white text-[10px] px-2 py-0.5 font-medium tracking-wide whitespace-nowrap">{{ sector() }}</span>}
      </a>

      <!-- Botón móvil -->
      <button type="button" (click)="toggleMobile()" [attr.aria-expanded]="mobileOpen()" aria-controls="mainMenu" aria-label="Abrir menú"
        class="ml-auto inline-flex sm:hidden items-center justify-center w-9 h-9 rounded-md bg-white/15 hover:bg-white/25 transition">
        <span class="sr-only">Menú</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
          <path [attr.d]="mobileOpen() ? 'M6 6L18 18M6 18L18 6' : 'M3 6h18M3 12h18M3 18h18'"></path>
        </svg>
      </button>

      <!-- Navegación principal (desktop) -->
      <ul class="hidden sm:flex items-center gap-1 text-sm font-medium">
        <li>
          <a routerLink="/clientes" routerLinkActive="active"
            class="nav-btn" (click)="closeAll()"><i class="bi bi-people"></i><span>Clientes</span></a>
        </li>
        @if (sector() === 'SALUD') {
        <li>
          <a routerLink="/pacientes" routerLinkActive="active" class="nav-btn" (click)="closeAll()"><i class="bi bi-heart-pulse"></i><span>Pacientes</span></a>
        </li>
        }
        <li>
          <a routerLink="/trabajos" routerLinkActive="active" class="nav-btn" (click)="closeAll()"><i class="bi bi-briefcase"></i><span>Trabajos</span></a>
        </li>
        <li>
          <a routerLink="/reportes" routerLinkActive="active" class="nav-btn" (click)="closeAll()"><i class="bi bi-bar-chart"></i><span>Reportes</span></a>
        </li>
        @if (role() === 'ADMIN') {
        <li class="relative" #adminDropdown>
          <button type="button" data-dd-toggle (click)="toggleAdmin()" [attr.aria-expanded]="adminOpen()" class="nav-btn"><i class="bi bi-shield-lock"></i><span>Admin</span>
            <svg viewBox="0 0 24 24" class="w-4 h-4 ml-1 transition-transform" [class.rotate-180]="adminOpen()"><path fill="currentColor" d="M7 10l5 5 5-5H7z"/></svg>
          </button>
          @if (adminOpen()) {
            <!-- Dropdown: posicionar debajo del botón -->
            <ul class="abs-dropdown left-0 top-full mt-2 w-48">
              <li><a routerLink="/usuarios" (click)="closeAll()" class="dd-item"><i class="bi bi-people"></i><span>Usuarios</span></a></li>
              <li><a routerLink="/formas-pago" (click)="closeAll()" class="dd-item"><i class="bi bi-cash-coin"></i><span>Formas de pago</span></a></li>
              <li><a routerLink="/grupos" (click)="closeAll()" class="dd-item"><i class="bi bi-diagram-3"></i><span>Grupos</span></a></li>
              <li><a routerLink="/configuracion" (click)="closeAll()" class="dd-item"><i class="bi bi-gear"></i><span>Configuración</span></a></li>
            </ul>
          }
        </li>
        }
      </ul>

      <!-- Usuario (desktop) -->
      <div class="hidden sm:flex items-center ml-auto relative" #userDropdown>
        <button type="button" data-dd-toggle (click)="toggleUser()" [attr.aria-expanded]="userOpen()" class="flex items-center gap-2 px-2 py-1.5 rounded-md hover:bg-white/15 transition text-sm font-medium">
          <span class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-white text-primary font-bold text-[10px] uppercase border border-white/30">{{ initials(userName()) }}</span>
          <span class="hidden md:inline truncate max-w-[140px]" [attr.title]="userName()">{{ userName() }}</span>
          <svg viewBox="0 0 24 24" class="w-4 h-4 transition-transform" [class.rotate-180]="userOpen()"><path fill="currentColor" d="M7 10l5 5 5-5H7z"/></svg>
        </button>
        @if (userOpen()) {
          <!-- Dropdown usuario debajo del botón -->
          <ul class="abs-dropdown right-0 top-full mt-2 w-56">
            <li class="px-3 py-2 text-[11px] font-medium text-slate-600 uppercase tracking-wide border-b border-slate-200/60">{{ empresa() }} — {{ role() }}</li>
            <li><a routerLink="/perfil" (click)="closeAll()" class="dd-item"><i class="bi bi-person"></i><span>Mi perfil</span></a></li>
            <li><button type="button" (click)="logout()" class="dd-item text-red-600 hover:text-red-700"><i class="bi bi-box-arrow-right"></i><span>Salir</span></button></li>
          </ul>
        }
      </div>
    </div>

    <!-- Menú móvil desplegable -->
    @if (mobileOpen()) {
      <div id="mainMenu" class="sm:hidden border-t border-white/25 pt-3 pb-4 space-y-2">
        <div class="grid grid-cols-2 gap-2 text-sm">
          <a routerLink="/clientes" routerLinkActive="active" class="mob-link" (click)="closeAll()">Clientes</a>
          <a routerLink="/trabajos" routerLinkActive="active" class="mob-link" (click)="closeAll()">Trabajos</a>
          <a routerLink="/reportes" routerLinkActive="active" class="mob-link" (click)="closeAll()">Reportes</a>
          @if (sector() === 'SALUD') {<a routerLink="/pacientes" routerLinkActive="active" class="mob-link" (click)="closeAll()">Pacientes</a>}
          @if (role() === 'ADMIN') {<a routerLink="/usuarios" class="mob-link" (click)="closeAll()">Usuarios</a>}
          @if (role() === 'ADMIN') {<a routerLink="/formas-pago" class="mob-link" (click)="closeAll()">Formas de pago</a>}
          @if (role() === 'ADMIN') {<a routerLink="/grupos" class="mob-link" (click)="closeAll()">Grupos</a>}
          @if (role() === 'ADMIN') {<a routerLink="/configuracion" class="mob-link" (click)="closeAll()">Configuración</a>}
          <a routerLink="/perfil" class="mob-link col-span-2" (click)="closeAll()">Mi perfil</a>
          <button type="button" (click)="logout()" class="mob-link col-span-2 text-red-200 hover:text-white">Salir</button>
        </div>
      </div>
    }
  </div>
</nav>