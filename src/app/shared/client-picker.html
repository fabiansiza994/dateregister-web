<!-- Modal Cliente -->
<div class="modal modal-light" tabindex="-1" [class.show]="isOpen" [style.display]="isOpen ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title d-flex align-items-center gap-2">
          <i class="bi bi-people"></i> Seleccionar cliente
        </h5>
        <button type="button" class="btn-close" (click)="close()"></button>
      </div>

      <div class="modal-body">
        <!-- Tabs (buscar/crear) -->
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" role="tab" [class.active]="tab()==='buscar'" aria-selected="{{tab()==='buscar'}}" (click)="tab.set('buscar')">Buscar</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" type="button" role="tab" [class.active]="tab()==='crear'" aria-selected="{{tab()==='crear'}}" (click)="tab.set('crear')">Crear</button>
          </li>
        </ul>

        <!-- BUSCAR -->
        @if (tab()==='buscar') {
        <div class="mt-3">
          <div class="flex flex-col sm:flex-row gap-2">
            <input class="form-control w-full" type="text" placeholder="Buscar por nombre/apellido…"
                   [(ngModel)]="q" (keyup.enter)="onSearch()">
            <button class="btn btn-soft-primary w-full sm:w-auto" (click)="onSearch()">
              <i class="bi bi-search"></i> Buscar
            </button>
          </div>

          <div class="dr-divider"></div>

          <div *ngIf="loading()" class="text-secondary small mb-2">
            <i class="bi bi-arrow-repeat me-1"></i> Cargando…
          </div>
          <div *ngIf="error()" class="alert alert-danger py-2">{{ error() }}</div>

          <div class="dr-grid max-h-[50vh] overflow-y-auto pr-1" *ngIf="items().length > 0; else noResC">
            <button type="button" class="dr-item text-start" *ngFor="let c of items()" (click)="choose(c)">
              <div class="d-flex align-items-center justify-content-between">
                <div class="fw-semibold">{{ c.nombre }} {{ c.apellido || '' }}</div>
                <span class="dr-badge">
                  <i class="bi bi-person"></i> ID {{ c.id }}
                </span>
              </div>
              <div class="text-secondary small mt-1">
                {{ c.identificacion || c.email || '—' }}
              </div>
            </button>
          </div>
          <ng-template #noResC>
            <div *ngIf="!loading()" class="text-secondary small mt-3">No hay resultados.</div>
          </ng-template>

          <!-- Paginación -->
          <div class="d-flex justify-content-between align-items-center mt-3">
            <button class="btn btn-ghost" (click)="prev()" [disabled]="page()<=1">
              <i class="bi bi-chevron-left"></i> Anterior
            </button>
            <div class="small text-secondary">
              Página {{ page() }} / {{ totalPages() }} · {{ total() }} resultados
            </div>
            <button class="btn btn-ghost" (click)="next()" [disabled]="page()>=totalPages()">
              Siguiente <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>
        }

        <!-- CREAR -->
        @if (tab()==='crear') {
        <div class="mt-3">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Nombre</label>
              <input class="form-control" [(ngModel)]="createForm.nombre" name="c_nombre" autocomplete="off">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Apellido</label>
              <input class="form-control" [(ngModel)]="createForm.apellido" name="c_apellido" autocomplete="off">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Email</label>
              <input class="form-control" [(ngModel)]="createForm.email" name="c_email" autocomplete="off">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Teléfono</label>
              <input class="form-control" [(ngModel)]="createForm.telefono" name="c_telefono" autocomplete="off">
            </div>
            <div class="col-12 col-md-12">
              <label class="form-label">Dirección</label>
              <input class="form-control" [(ngModel)]="createForm.direccion" name="c_direccion" autocomplete="off">
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Identificación (opcional)</label>
              <input class="form-control" [(ngModel)]="createForm.identificacion" name="c_ident" autocomplete="off">
            </div>
          </div>

          @if (error()) {
            <div class="alert alert-danger mt-3 py-2">{{ error() }}</div>
          }

          <div class="d-flex justify-content-end mt-3">
            <button class="btn btn-soft-primary" (click)="createClient()" [disabled]="creating()">
              @if (creating()) { <span class="spinner-border spinner-border-sm me-2"></span> }
              Crear cliente
            </button>
          </div>
        </div>
        }
      </div>

      <div class="modal-footer">
        <button class="btn btn-ghost" (click)="close()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
