<div class="d-flex align-items-start justify-content-between flex-column flex-sm-row gap-2 mb-3">
  <div>
    <h3 class="fw-semibold mb-0">Detalle de usuario</h3>
    <small class="text-secondary">Información general y estado</small>
  </div>
  <div class="d-flex gap-2 w-100 w-sm-auto">
    <a class="btn btn-light w-100 w-sm-auto" (click)="backToList()">
      <i class="bi bi-arrow-left"></i> Volver
    </a>
    <a class="btn btn-primary w-100 w-sm-auto" [routerLink]="['/usuarios', usuario()?.id, 'editar']" *ngIf="usuario()">
      <i class="bi bi-pencil"></i> Editar
    </a>
  </div>
</div>

@if (error()) {
  <div class="alert alert-danger d-flex align-items-start gap-2" role="alert">
    <i class="bi bi-exclamation-triangle mt-1"></i>
    <div>{{ error() }}</div>
  </div>
}

@if (loading()) {
  <div class="text-center text-secondary py-4">
    <span class="spinner-border spinner-border-sm"></span> Cargando…
  </div>
} @else {
  @if (!usuario()) {
    <div class="alert alert-light border">No hay datos para mostrar.</div>
  } @else {
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body">
        <!-- Encabezado bonito dentro de la tarjeta -->
        <div class="d-flex align-items-center gap-3 mb-3">
    <div class="text-white fw-bold"
      style="display:grid; place-items:center; width:56px; height:56px; line-height:1; text-align:center; border-radius:9999px; background: linear-gradient(135deg, hsl(219,82%,48%), hsl(259,82%,62%)); font-size:18px;">
            {{ (usuario()?.nombre || usuario()?.usuario || 'U').slice(0,1).toUpperCase() }}{{ (usuario()?.apellido || '').slice(0,1).toUpperCase() }}
          </div>
          <div class="min-w-0">
            <div class="fw-semibold text-truncate">
              {{ (usuario()?.nombre || '') + (usuario()?.apellido ? ' ' + usuario()?.apellido : '') || usuario()?.usuario || 'Usuario' }}
            </div>
            <div class="text-secondary small text-truncate">
              @if (usuario()?.usuario) { <span class="me-2">@{{ usuario()?.usuario }}</span> }
              @if (usuario()?.email) {
                <a [href]="'mailto:' + usuario()?.email" class="text-decoration-none text-secondary text-truncate d-inline-block" style="max-width: 220px;">
                  <i class="bi bi-envelope me-1"></i>{{ usuario()?.email }}</a>
              }
            </div>
            <div class="d-flex flex-wrap gap-2 mt-2">
              @if (usuario()?.grupoNombre) { <span class="badge bg-light border text-dark">Grupo: {{ usuario()?.grupoNombre }}</span> }
              @if (usuario()?.rolNombre)   { <span class="badge bg-light border text-dark">Rol: {{ usuario()?.rolNombre }}</span> }
              <span class="{{ badgeBloqueado(usuario()) }}">{{ usuario()?.bloqueado ? 'BLOQUEADO' : 'ACTIVO' }}</span>
            </div>
          </div>
        </div>

        <hr class="my-3">

        <div class="row row-cols-1 row-cols-md-2 g-3">
          <div class="col">
            <div class="small text-secondary">ID</div>
            <div class="fw-semibold">{{ usuario()?.id }}</div>
          </div>

          <div class="col">
            <div class="small text-secondary">Intentos fallidos</div>
            <div>{{ usuario()?.intentosFallidos }}</div>
          </div>
        </div>
      </div>
    </div>
  }
}
